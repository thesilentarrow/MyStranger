{% load humanize %}
{% load static %}

{% comment %} {{is_active}} bbbbbbmn {% endcomment %}

{% for question in question_top2_answers %}
        <div class="card card-main mb-4" id="card-main-{{question.0.id}}">
           
            <div class="card-header">
                <div style="width:100%" >
                    <div class="tp1">
                        <span class="text-secondary small-text" style="font-size:12px; margin-bottom:0px;">
                            
                            <span class="heading-top"><a style="color:#009cda; margin-right:0.5em;" href="{% url "account:view" user_id=question.0.owner.id %}"><span>{{question.0.owner.name}} | {{question.0.owner.university_name}}</span> </a></span> 
                            
                            <span class="timepamper"> {{question.0.timestamp|naturaltime}} </span></span>

                        <div class="tp1-right">

                        {% if question.0.owner != request.user %}
                            
                            <button class="add-friend-btn" onclick="add_friend('send_req_btn-{{question.0.pk}}','{{question.0.owner.pk}}', 'cancel_req_btn-{{question.0.pk}}')" id="send_req_btn-{{question.0.pk}}"><span class="img1"><img src="{% static 'images/add.svg' %}"
                                width="26px" alt="" srcset=""></span></button>
                            <button class="d-none cancel_btn" onclick="cancel_friend('send_req_btn-{{question.0.pk}}','{{question.0.owner.pk}}', 'cancel_req_btn-{{question.0.pk}}')" id="cancel_req_btn-{{question.0.pk}}"><i class="fa-solid fa-xmark "
                            style="color:red;"></i></button>

                            <button class="share-btn" onclick="openShareModal('{{question.0.pk}}')"><i class="fa-solid fa-share-from-square" style="color: #343a40;"></i></button>


                            {% comment %} <div class="dropdown">
                        
                                <button class="btn btn-secondary dropdown-toggle dots" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <span style="margin-left:1em; display: flex; margin-top: 4px;" class="img2"><i class="fa-solid fa-ellipsis-vertical"></i></span></button>
        
                                    
                                    <ul class="dropdown-menu report-dpn">
                                      
                                    <li><button class="dropdown-item" type="button">Report</button></li>
                                    
                                      
                                    </ul>
                                  </div> {% endcomment %}
                            

                        {% endif %}


                        {% if question.0.owner == request.user %}

                        <button class="share-btn" onclick="openShareModal('{{question.0.pk}}')"><i class="fa-solid fa-share-from-square" style="color: #343a40;"></i></button>

                        <div class="dropdown">
                        
                            <button class="btn btn-secondary dropdown-toggle dots" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <span style="margin-left:1em; display: flex; margin-top: 4px;" class="img2"><i class="fa-solid fa-ellipsis-vertical"></i></span></button>
    
                                
                                <ul class="dropdown-menu report-dpn">

                                {% if request.user.is_authenticated %}

                                  
                                <li><button class="dropdown-item" onclick="myquestiondeletefunc('{{question.0.id}}', 'card-main-{{question.0.id}}')" type="button">Delete</button></li>

                                {% else %}
                                    <li><button disabled class="dropdown-item" onclick="myquestiondeletefunc('', 'card-main')" type="button">Delete</button></li>
                                {% endif %}
                                
                                  
                                </ul>
                            </div>

                        {% endif %}


                        
                    </div>

                </div>

                <div class="tp2">
                    <strong class="the-ques"  style="font-size: 17px; word-break: break-word;">{{question.0.question}}</strong>
                    <span class="text-secondary total_ans_box d-flex justify-content-center" style="font-size:12px; margin-left: 2em; min-width:78px; " >{{ question.0.ans_count }} {% if question.0.ans_count < 2 %}answer{% else %}answers{% endif %}</span>
                </div>
                
                </div>
                
            </div>
            <!-- <div class="card-body heading-top">
            
                <p>Nearby Universities</p>
                <p>Users</p>  
            
            </div> -->

            {% if question.0.image %}
            {% comment %} <div class="image-container" style="width: 100%; margin:auto; height: 150px; overflow: hidden; border: 1px solid #ccc;">
                <img src="{{ question.0.image.url }}" alt="Image Preview" style="width: 100%; height: 100%; object-fit: contain;">
            </div> {% endcomment %}

            <a href="{{ question.0.image.url }}" class="image-lightbox-link" onclick="openLightboxnamo(this)">
                <div class="image-container" style="width: 100%; margin:auto; height: 225px; overflow: hidden; border:none;">
                    <img src="{{ question.0.image.url }}" alt="Image Preview" id="previewImage" style="width: 100%; height: 100%; object-fit: contain;" {% if request.user_agent.is_mobile %} onload="adjustHeight(this)"{% endif %}>
                </div>
            </a>
            
            <!-- Lightbox container -->
            <div class="image-lightbox">
                <span class="close-button" onclick="closeLightbox(this)">&times;</span>
                <div class="lightbox-content">
                    <img class="lightbox-image" src="" alt="Full Image">
                </div>
            </div>

            {% elif question.0.video %}
                <video width="50%" height="auto" id="video-{{question.0.id}}" style="margin:auto;" controls muted loop onloadeddata="addVideoEventListeners(this)" {% if question.0.thumbnail %} poster="{{question.0.thumbnail.url}}"{% endif %}>
                    <source src="{{ question.0.video.url }}" type="video/mp4">
                </video>
        {% endif %}

            {% if not question.0.polls.all %}
                        {% comment %} <p class="p-4" >No polls</p> {% endcomment %}
                {% else %}
                <div class="poll-area">
                    <div style="border: 1px solid #343a40;
                    position: relative;
                    padding: 20px 20px 5px 20px;
                    border-radius: 14px;" class="total-line">
                        <div style="    background: white;
                        left: 17px;
                        position: absolute;
                        top: -17px;
                        padding: 5px;" class="total-count">
                            <span style="font-size:14px;" id="poll-count-{{question.0.id}}">{{question.0.poll_count}} vibes</span>
                        </div>
                    

                        {% if question.3 %}
							{% comment %} {{request.user.name}} has already polled this poll {% endcomment %}

							{% for poll in question.0.polls.all %}
						
	
								{% comment %} <div class="row">
								  <div class="column">
									<span class="circle"></span>
									<span class="text">{{poll.option}}</span>
								  </div>
								  <span class="percent"></span>
								</div>
								<div class="progress" style=''></div>
							  {% endcomment %}
	
							  <div class="poll-{{question.0.id}} thepoll-cont" id="poll-{{poll.id}}" style="padding: 6px 12px;
							  border: 1px solid #8d8d8d;
							  border-radius: 8px;
							  margin-bottom: 8px;
							  position: relative;
							  height: 30px;" 
							  
							  {% if request.user.is_authenticated %}    {% endif %} >
							  <div style="z-index:1; width:{{poll.percentage}}%!important"  class="innerbar" id="innerbar-{{poll.id}}">
							</div>
							  <span class="poll-optieon" style="position: absolute;
							  z-index: 2;
							  top: 2px;
							  font-size: 14px;">{{poll.option}}
								</span>
								<span style="font-size: 12px;"><span class="percetion" style="position:absolute; right:20px; z-index:2;" class="percentage" id="persia-{{poll.id}}">{{poll.percentage}}%</span><span style="font-size: 10px;
								{% if request.user in poll.polled.all %} display:flex; {% else %} display: none; {% endif %}
								
								position: absolute;
								right: 6px;
								top: 10px;
								z-index: 2;" class='tick-percetion' id="tick-{{poll.id}}"><i class="fa-solid fa-check" style="color: #009cda;"></i></span></span>
								<span style="
								display: none; 
								position: absolute;
								left: -14px;
								top: 17px;							
								z-index: 2;
								" id='ac-poll-{{poll.id}}'><i class="fa-solid fa-circle" style="color: #009cda; font-size:8px;"></i></span>
							</div>

							
							  
						{% endfor %}

						<span style="font-size:11px; display: none;" class="text-secondary;">{{account.name}} vibed at <i class="fa-solid fa-circle" style="color: #009cda; font-size:8px;"></i> </span>

							{% else %}


                    {% for poll in question.0.polls.all %}
                    

                            {% comment %} <div class="row">
                              <div class="column">
                                <span class="circle"></span>
                                <span class="text">{{poll.option}}</span>
                              </div>
                              <span class="percent"></span>
                            </div>
                            <div class="progress" style=''></div>
                          {% endcomment %}

                          <div class="poll-{{question.0.id}} thepoll-cont" id="poll-{{poll.id}}" style="padding: 6px 12px;
                          border: 1px solid #8d8d8d;
                          border-radius: 8px;
                          margin-bottom: 8px;
                          position: relative;
                          height: 30px;" 
                          
                          {% if request.user.is_authenticated %} onclick="myselecfunc('{{poll.id}}','{{question.0.id}}')"  {% endif %} >
                          <div style="z-index:1;" class="innerbar" id="innerbar-{{poll.id}}">
                        </div>
                          <span class="poll-optieon" style="position: absolute;
                          z-index: 2;
                          top: 2px;
                          font-size: 14px;">{{poll.option}}
                            </span>
                            <span style="font-size: 12px;"><span class="percetion" style="position:absolute; right:20px; z-index:2;" class="percentage" id="persia-{{poll.id}}"></span><span style="font-size: 10px;
                            display: none;
                            position: absolute;
                            right: 6px;
                            top: 10px;
                            z-index: 2;" class='tick-percetion' id="tick-{{poll.id}}"><i class="fa-solid fa-check" style="color: #009cda;"></i></span></span>
                        </div>
                          
                    {% endfor %}
                    {% endif %}
                </div>
                    </div>
            {% endif %}
           
            <div class="card">
                {% comment %} <div class="card-body" style="flex-direction: column;"> {% endcomment %}
                   

                    {% if not question.0.answers.all %}
                        {% if not question.0.polls.all and not question.0.image  and not question.0.video%}
                        <p class="p-4" >Be the first to answer {{question.0.owner.name}}'s question</p>
                        {% endif %}
                    {% else %}
                        {% comment %} {% for answer in question.answers.all %} {% endcomment %}
                        {% load mptt_tags %}
                        {% if not question.0.polls.all %}
                            {% recursetree question.1 %}

                            {% comment %} {% if node.ans_reported.all|length > 5 %}{% endif %} {% endcomment %}
                            <div class="card card-answer card-reply" id="card-{{node.id}}">
                                <div class="card-body card-body-answer" style="flex-direction: column;">

                                
                                {% comment %} {% if node.level ==0 %}{% endif %} {% endcomment %}

                                <div style="width:100%" >
                                    <div class="tp1">
                                
                                <p class="text-secondary small-text answer-info" style="font-size:12px; margin-bottom:0px;"><a style="color:#009cda; margin-right:0.5em;" href="{% url "account:view" user_id=node.user.id %}"><span>{{node.user.name}} | {{node.user.university_name}}</span> </a>
                                    {% if request.user.id == node.user.id %}
                                    {% comment %} <span><button class="btn btn-sm btn-outline-dark ml-4" onclick="mydeletefunc('{{node.id}}', 'card-{{node.id}}')">delete</button></span> {% endcomment %}
                                    {% endif %}
                                <span class="timepamper">
                                     {{node.timestamp|naturaltime}} </span>

                                </p>

                                <div class="tp1-right">

                                    {% if node.user != request.user %}

                                    <button class="add-friend-btn" onclick="add_friend('send_req_btn-{{node.pk}}','{{node.user.pk}}', 'cancel_req_btn-{{node.pk}}')" id="send_req_btn-{{node.pk}}"><span class="img1"><img src="{% static 'images/add.svg' %}"
                                        width="26px" alt="" srcset=""></span></button>
                                    <button class="d-none cancel_btn" onclick="cancel_friend('send_req_btn-{{node.pk}}','{{node.user.pk}}', 'cancel_req_btn-{{node.pk}}')" id="cancel_req_btn-{{node.pk}}"><i class="fa-solid fa-xmark "
                                    style="color:red;"></i></button>

                                    {% endif %}
            
                                    
                                    {% comment %} <span style="margin-left:1em; display: flex; margin-top: 4px;" class="img2"><i class="fa-solid fa-ellipsis-vertical"></i></span> {% endcomment %}

                                    <div class="dropdown">
                        
                                        <button class="btn btn-secondary dropdown-toggle dots" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            <span style="margin-left:1em; display: flex; margin-top: 4px;" class="img2"><i class="fa-solid fa-ellipsis-vertical"></i></span></button>
                
                                            
                                            <ul class="dropdown-menu report-dpn">
                                            {% if node.user != request.user %}

                                            {% if request.user.is_authenticated %}

                                                <li><button class="dropdown-item" onclick="myreportfunc('{{node.pk}}')"  type="button">Report</button></li>

                                            {% else %}

                                            <li><button disabled class="dropdown-item" onclick="myreportfunc('')"  type="button">Report</button></li>

                                            {% endif %}

                                            {% else %}
                                            <li><button class="dropdown-item" onclick="mydeletefunc('{{node.id}}', 'card-{{node.id}}')" type="button">Delete</button></li>
                                            {% endif %}
                                            
                                              
                                            </ul>
                                          </div>
                                
                                </div>

                            </div>
                            </div>

                                {% comment %} <p style="margin-bottom:0px; margin-top:2px;" >{{node.content}}</p> {% endcomment %}
                                <span class="ans_texti" style="width:96%;">
                                {% if node.content|length > 250 %}
                                {% with first_part=node.content|slice:":250" second_part=node.content|slice:"250:" %}
                                <span id="partial-paragraph">{{ first_part }}

                                    <span class="secondary-text mb-2" style="width:80px; border:none; background:none; color:#009cda; font-size:12px;" type="button"  id="contentcont-{{node.pk}}" onclick="myreadmorefunc('contentcont-{{node.pk}}')" data-bs-toggle="collapse" data-bs-target="#content-{{node.pk}}" aria-expanded="false" aria-controls="collapseExample">
                                        ... read more
                                    </span>
                                

                                    <span class="collapse" id="content-{{node.pk}}">

                                       
                                        {{ second_part }}
                                        
                                    </span>

                                </span>
                                
                                    
                                {% endwith %}
                            {% else %}
                                <div id="full-paragraph">{{ node.content }}</div>
                            {% endif %}
                        </span>

                        
                        {% if node.level < 2  %}
                            <div style="margin-top:4px; display:flex;"> {% endif %}
                            
                            {% if request.user not in node.likes.all %}

                                <span id="like-{{node.pk}}" ><button class="like-btn" onclick="mylikefunc('{{node.pk}}')"><i class="fa-regular fa-heart f12" style="color: #009cda; font-size:14px;"></i> <span id="like-count-{{node.pk}}"> {{node.likes.all|length}} </span></button></span>

                            {% else %}

                            {% if request.user.is_authenticated %}
                            
                                <span id="like-{{node.pk}}" style="display:none;" ><button class=" like-btn" onclick="mylikefunc('{{node.pk}}')"><i class="fa-regular fa-heart f12" style="color: #009cda; font-size:14px;"></i> <span id="like-count-{{node.pk}}"> {{node.likes.all|length}} </span></button></span>

                                {% else %}

                                <span id="like-{{node.pk}}" style="display:none;" ><button class=" like-btn" ><i class="fa-regular fa-heart f12" style="color: #009cda; font-size:14px;"></i> <span id="like-count-{{node.pk}}"> {{node.likes.all|length}} </span></button></span>

                                {% endif %}

                            
                                <span id="unlike2-{{node.pk}}" style="" ><button class=" like-btn" onclick="myunlikefunc('{{node.pk}}', 'unlike2-{{node.pk}}')"><i class="fa-solid fa-heart f12" style="color: #009cda; font-size:14px;"></i> <span id="count-unlike2-{{node.pk}}"> {{node.likes.all|length}}</span></button></span>

                            {% endif %}

                            <span id="unlike-{{node.pk}}" style="display:none;" ><button class=" like-btn" onclick="myunlikefunc('{{node.pk}}','unlike-{{node.pk}}')"><i class="fa-solid fa-heart f12" style="color: #009cda; font-size:14px;"></i> <span id="count-unlike-{{node.pk}}"> {{node.likes.all|length}}</span></button></span>

                            


                                {% if node.level < 2 %}
                                {% if request.user.is_authenticated %}
                                <span><button class="secondary-text f12" style="width:50px; border:none; background:none;  color: #009cda; font-size:14px;" type="button" data-bs-toggle="collapse" data-bs-target="#reply-{{node.pk}}" aria-expanded="false" aria-controls="collapseExample">
                                    reply
                                </button></span>
                                {% endif %}

                            </div>
                            
                                {% if request.user.is_authenticated %}

                           
                            <div class="collapse replybox" id="reply-{{node.pk}}">

                                
                                
                                <form class="answer-form" id="repform-{{node.id}}" onsubmit="submitForm(event, 'repform-{{node.id}}', 'null', 'reply-{{node.pk}}' , 'id_chat_message_input_answer-{{node.id}}' )" action="" method='post'> {% csrf_token %}
                                    <input hidden  type="text" name='question-id' id="question-{{question.0.id}}" value="{{question.0.id}}">
                                        <input hidden type="text" name='answer-id' id="parent-{{node.id}}" value="{{node.id}}">
                                        <textarea oninput="resizeTextarea(this)" style="margin-bottom: 1em;" class="flex-grow-1 quora-textarea reply-textarea" placeholder="Reply on stranger's answer" name="id_chat_message_input" id="id_chat_message_input_answer-{{node.id}}"></textarea>
                                        {% comment %} <textarea id="expandingTextarea" ></textarea> {% endcomment %}

                                        <button class="btn btn-sm btn-answer btn-dark" type="Submit"><span>reply</span></button>
                                    </form>
                                
                            </div> 

                                    {% endif %}
                                 
                                {% endif %}


                                
                                {% if not node.is_leaf_node %}

                                <button class="secondary-text mb-2 f12 view_rep_btn" style="width:80px; border:none; background:none; color:#009cda; font-size:13px; margin-left:6em; margin-top:-1.78em;" type="button" data-bs-toggle="collapse" data-bs-target="#replies-{{node.pk}}" aria-expanded="false" aria-controls="collapseExample">
                                    view replies
                                </button>

                            {% comment %} </div> {% endcomment %}

                                <div class="collapse" id="replies-{{node.pk}}">

                                    <div class="children pl-2 pl-md-5 card-reply-main">
                                    {{ children }}
                                    
                                    </div>

                                </div>
                                {% else %}

                                {% comment %} {% if node.level < 2 %} </div>  {% endif %} {% endcomment %}
                                
                            
                                {% endif %}
                        
                                
                </div>
                
            </div>
            
            {% comment %} <div class="card">
                <div class="card-body" style="flex-direction: column;"> {% endcomment %}



                            {% endrecursetree %}
                            {% endif %}
                            
                        {% comment %} {% endfor %} {% endcomment %}
                    {% endif %}

                     {% comment %} <div>
                        <form style="border:2px solid" class="answer-form" id="ansform-{{question.0.pk}}" onsubmit="submitForm(event, 'ansform-{{question.0.pk}}')" action="" method='post'> {% csrf_token %}
                            <input hidden type="text" name='question-id' id="question-{{question.0.pk}}" value="{{question.0.pk}}">
                            <textarea class="flex-grow-1 quora-textarea" placeholder="Answer stranger's question" name="id_chat_message_input" id="id_chat_message_input"></textarea>
                            <button class="btn btn-sm btn-answer btn-dark" type="Submit"><span>Add answer</span></button>
                        </form>
                    </div>   {% endcomment %}


                    <!-- <div> -->
                    {% comment %} <p style="margin-bottom:4px;">it's such a shitty university u r not gonna believe what happened to .......</p> {% endcomment %}
                    {% comment %} <p class="text-secondary" style="font-size:12px; margin-bottom:0px;">shreya | amity university</p></div> {% endcomment %}
                    {% comment %} <a href="{% url "qna:minichat" user_id=question.pk %}" class="" style="font-size:14px; text-align: center; margin-bottom:0px;">see answers</a> {% endcomment %}

                    {% comment %} <a href="" class="" style="font-size:14px; text-align: center; margin-bottom:0px;">see answers</a> {% endcomment %}


                    </div>

                    

            {% comment %} <div class="card"> {% endcomment %}

                {% if question.2 %}

                    <button class="secondary-text mb-2 smaf" onclick="mytoogleanswersfunc('more-ans-{{question.0.pk}}')" style="width:115px; border:none; background:none; color:#009cda; font-size:12px;" type="button" id="more-ans-{{question.0.pk}}" data-bs-toggle="collapse" data-bs-target="#question-{{question.0.pk}}" aria-expanded="false" aria-controls="collapseExample">see more answers</button> 

                    

                    <div class="collapse" id="question-{{question.0.pk}}">

                        <div class="card answers-card" >
                            {% comment %} <div class="card-body" style="flex-direction: column;"> {% endcomment %}
                            

                            {% load mptt_tags %}
                        
                            {% recursetree question.2 %}

                            <div class="card card-answer card-reply" id="card-{{node.id}}">
                                <div class="card-body card-body-answer" style="flex-direction: column;">

                                
                                {% comment %} {% if node.level ==0 %}{% endif %} {% endcomment %}

                                
                                {% comment %} <p class="text-secondary" style="font-size:12px; margin-bottom:0px;">{{node.user.name}}</p> {% endcomment %}

                                <div style="width:100%" >
                                    <div class="tp1">

                                <p class="text-secondary small-text " style="font-size:12px; margin-bottom:0px;"><a style="color:#009cda; margin-right:0.5em;" href="{% url "account:view" user_id=node.user.id %}"><span>{{node.user.name}} | {{node.user.university_name}}</span> </a>
                                    {% comment %} {% if request.user.id == node.user.id %}
                                    <span><button class="btn btn-sm btn-outline-dark ml-4 d-none" onclick="mydeletefunc('{{node.id}}', 'card-{{node.id}}')">delete</button></span>
                                    {% endif %} {% endcomment %}
                                    <span class="timepamper">
                                        {{node.timestamp|naturaltime}} </span>
                                
                                </p>

                                <div class="tp1-right">

                                    {% if node.user != request.user %}

                                        <button class="add-friend-btn" onclick="add_friend('send_req_btn-{{node.pk}}','{{node.user.pk}}', 'cancel_req_btn-{{node.pk}}')" id="send_req_btn-{{node.pk}}"><span class="img1"><img src="{% static 'images/add.svg' %}"
                                            width="26px" alt="" srcset=""></span></button>
                                        <button class="d-none cancel_btn" onclick="cancel_friend('send_req_btn-{{node.pk}}','{{node.user.pk}}', 'cancel_req_btn-{{node.pk}}')" id="cancel_req_btn-{{node.pk}}"><i class="fa-solid fa-xmark "
                                        style="color:red;"></i></button>

                                    {% endif %}
            
                                    
                                    {% comment %} <span style="margin-left:1em; display: flex; margin-top: 4px;" class="img2"><i class="fa-solid fa-ellipsis-vertical"></i></span> {% endcomment %}

                                    <div class="dropdown">
                        
                                        <button class="btn btn-secondary dropdown-toggle dots" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            <span style="margin-left:1em; display: flex; margin-top: 4px;" class="img2"><i class="fa-solid fa-ellipsis-vertical"></i></span></button>
                
                                            
                                            <ul class="dropdown-menu report-dpn">
                                            {% if node.user != request.user %}
                                                {% if request.user.is_authenticated %}
                                                 <li><button class="dropdown-item" onclick="myreportfunc('{{node.pk}}')" type="button">Report</button></li>
                                                {% else %}
                                                <li><button disabled class="dropdown-item" onclick="myreportfunc('')" type="button">Report</button></li>
                                                {% endif %}
                                            {% else %}
                                            <li><button class="dropdown-item" onclick="mydeletefunc('{{node.id}}', 'card-{{node.id}}')" type="button">Delete</button></li>
                                            {% endif %}
                                            
                                              
                                            </ul>
                                          </div>
                                
                                </div>

                            </div>
                        </div>


                        
                                {% comment %} <p style="margin-bottom:0px; margin-top:2px;" >{{node.content}}</p> {% endcomment %}

                                <span 
                                class="ans_texti"
                                style="width:96%;">
                                    {% if node.content|length > 250 %}
                                    {% with first_part=node.content|slice:":250" second_part=node.content|slice:"250:" %}
                                    <span id="partial-paragraph">{{ first_part }}
    
                                        <span class="secondary-text mb-2" style="width:80px; border:none; background:none; color:#009cda; font-size:12px;" type="button"  id="contentcont-{{node.pk}}" onclick="myreadmorefunc('contentcont-{{node.pk}}')" data-bs-toggle="collapse" data-bs-target="#content-{{node.pk}}" aria-expanded="false" aria-controls="collapseExample">
                                            ... read more
                                        </span>
                                    
    
                                        <span class="collapse" id="content-{{node.pk}}">
    
                                           
                                            {{ second_part }}
                                            
                                        </span>
    
                                    </span>
                                    
                                        
                                    {% endwith %}
                                {% else %}
                                    <div id="full-paragraph">{{ node.content }}</div>
                                {% endif %}
                            </span>
                                

                                {% if node.level < 2  %}
                            <div style="margin-top:4px; display:flex;"> {% endif %}

                                {% if request.user not in node.likes.all %}

                                <span id="like-{{node.pk}}" ><button class="like-btn" onclick="mylikefunc('{{node.pk}}')"><i class="fa-regular fa-heart f12" style="color: #009cda; font-size:14px;"></i> <span id="like-count-{{node.pk}}"> {{node.likes.all|length}} </span></button></span>

                            {% else %}

                            {% if request.user.is_authenticated %}
                            
                                <span id="like-{{node.pk}}" style="display:none;" ><button class="like-btn" onclick="mylikefunc('{{node.pk}}')"><i class="fa-regular fa-heart f12" style="color: #009cda; font-size:14px;"></i> <span id="like-count-{{node.pk}}"> {{node.likes.all|length}} </span></button></span>

                                {% else %}

                                <span id="like-{{node.pk}}" style="display:none;" ><button class="like-btn"><i class="fa-regular fa-heart f12" style="color: #009cda; font-size:14px;"></i> <span id="like-count-{{node.pk}}"> {{node.likes.all|length}} </span></button></span>

                                {% endif %}

                            
                                <span id="unlike2-{{node.pk}}" style="" ><button class="like-btn" onclick="myunlikefunc('{{node.pk}}', 'unlike2-{{node.pk}}')"><i class="fa-solid fa-heart f12" style="color: #009cda; font-size:14px;"></i> <span id="count-unlike2-{{node.pk}}"> {{node.likes.all|length}}</span></button></span>

                            {% endif %}

                            <span id="unlike-{{node.pk}}" style="display:none;" ><button class="like-btn" onclick="myunlikefunc('{{node.pk}}','unlike-{{node.pk}}')"><i class="fa-solid fa-heart f12" style="color: #009cda; font-size:14px;"></i> <span id="count-unlike-{{node.pk}}"> {{node.likes.all|length}}</span></button></span>

                                


                                {% comment %} {% if node.level < 3 %}
                                <button class="secondary-text" style="width:50px; border:none; background:none;" type="button" data-bs-toggle="collapse" data-bs-target="#{{node.pk}}" aria-expanded="false" aria-controls="collapseExample">
                                    reply
                                </button>
                            </p>
                            <div class="collapse" id="{{node.pk}}">
                                
                                <form class="answer-form" action="" method='post'> {% csrf_token %}
                                    <input hidden  type="text" name='question-id' id="question-{{question.id}}" value="{{question.id}}">
                                        <input hidden type="text" name='answer-id' id="parent-{{node.id}}" value="{{node.id}}">
                                        <textarea class="flex-grow-1 quora-textarea" placeholder="Reply on stranger's answer" name="id_chat_message_input" id="id_chat_message_input_answer"></textarea>
                                        <button class="btn btn-sm btn-answer btn-dark" type="Submit"><span>reply</span></button>
                                </form>
                                
                            </div> 
                                <hr> 
                                {% endif %} {% endcomment %}


                                {% if node.level < 2 %}
                                {% if request.user.is_authenticated %}

                                <span><button class="secondary-text f12" style="width:50px; border:none; background:none; color: #009cda; font-size:14px;" type="button" data-bs-toggle="collapse" data-bs-target="#reply-{{node.pk}}" aria-expanded="false" aria-controls="collapseExample">
                                    reply
                                </button></span>

                                {% endif %}
                           
                            </div>

                            {% if request.user.is_authenticated %}


                            <div class="collapse replybox" id="reply-{{node.pk}}">
                                
                                <form class="answer-form" id="repform-{{node.id}}" onsubmit="submitForm(event, 'repform-{{node.id}}', 'null', 'reply-{{node.pk}}', 'id_chat_message_input_answer-{{node.id}}')" action="" method='post'> {% csrf_token %}
                                    <input hidden  type="text" name='question-id' id="question-{{question.0.id}}" value="{{question.0.id}}">
                                        <input hidden type="text" name='answer-id' id="parent-{{node.id}}" value="{{node.id}}">
                                        <textarea oninput="resizeTextarea(this)" class="flex-grow-1 quora-textarea reply-textarea" placeholder="Reply on stranger's answer" name="id_chat_message_input" id="id_chat_message_input_answer-{{node.id}}"></textarea>
                                        <button class="btn btn-sm btn-answer btn-dark" type="Submit"><span>reply</span></button>
                                    </form>
                                
                            </div> 

                                {% endif %}
                                 
                                {% endif %}

                                {% if not node.is_leaf_node %}

                                <button class="secondary-text mb- view_rep_btn f12" style="width:80px; border:none; background:none; color:#009cda; font-size:13px; margin-left:6em; margin-top:-1.78em;" type="button" data-bs-toggle="collapse" data-bs-target="#replies-{{node.pk}}" aria-expanded="false" aria-controls="collapseExample">
                                    view replies
                                </button>

                                <div class="collapse" id="replies-{{node.pk}}">

                                    <div class="children pl-2 pl-md-5 card-reply-main">
                                    {{ children }}
                                    </div>

                                </div>
                                {% endif %}
                                 
                                    

                                </div>
                            </div>
                            {% endrecursetree %}
                            

                        </div>

                    </div>

                {% endif %}

                

                <div id="elemental-{{question.0.pk}}">

                    
                    {% if request.user.is_authenticated %}
                    
                    {% comment %} {% if not question.0.polls.all %} {% endcomment %}
                    <form class="answer-form" style="{% if question.0.image %}margin-top:1em; width: 80%;{% endif %}" id="ansform-{{question.0.pk}}" onsubmit="submitForm(event, 'ansform-{{question.0.pk}}', 'elemental-{{question.0.pk}}', 'null', 'id_chat_message_input-{{question.0.pk}}')" action="" method='post'> {% csrf_token %}
                        <input hidden type="text" name='question-id' id="question-{{question.0.pk}}" value="{{question.0.pk}}">
                        <textarea oninput="resizeTextarea(this)" class="flex-grow-1 quora-textarea" placeholder="Answer stranger's question" name="id_chat_message_input" id="id_chat_message_input-{{question.0.pk}}"></textarea>

                            <button class="btn btn-sm btn-answer btn-dark" type="Submit"><span>Add answer</span></button>

                            
                        </form>
                        {% comment %} {% endif %} {% endcomment %}
                        {% else %}
                       

                           <p style="font-size:12px; text-align:center;">~login to answer</p>
                    {% endif %}
                </div>  

                    {% comment %} <button class="btn btn-sm btn-outline-dark">See Answers</button> {% endcomment %}
                    
                    {% comment %} <a class="nearby-num" href="#"><button class="btn btn-sm btn-outline-dark">{{delta.students}} Students</button></a> {% endcomment %}
                
        
                </div>
            {% comment %} </div> {% endcomment %}
        {% comment %} </div> {% endcomment %}
            
            {% endfor %}